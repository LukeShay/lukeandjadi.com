on:
  workflow_call:
    secrets:
      migration_dsn:
        required: true
      cluster_id:
        required: true

jobs:
  migrate:
    runs-on: ubuntu-20.04
    steps:
      - uses: actions/checkout@v2
      - run: make db-cert
        env:
          CLUSTER_ID: ${{ secrets.cluster_id }}
      - run: make schema-migrate
        env:
          DSN: '${{ secrets.migration_dsn }}?sslmode=verify-full\\&sslrootcert=./db/certs/root.crt'
